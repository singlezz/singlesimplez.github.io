---
title: 数据库时间格式处理
date: 2020-04-15 14:40:21
tags: Java
categories: 时间处理
description: Java对数据库的时间处理
---

# 前言：

本帖对于项目中的数据库的时间进行处理。

# 正文：

博主在做一个列表的时候从MongoDB中查出来的数据包含有时间格式，在MongoDB数据库中的存放形式为`2017-10-24 05:18:54.000Z`,而对于使用Java查询是String接受的值为`Tue Oct 24 13:18:54 CST 2017`。

本来的做法是使用第三方工具类`hutool-all`的`DateUtil`进行转换。

例如：

```java
//数据格式转换
List<AuthLogEntity> resultList = new ArrayList<>();
for (AuthLogEntity authLogEntity: list) {   //list为mongo查询的数据集合
	Date createTime = DateUtil.parse(authLogEntity.getCreateTime());
	authLogEntity.setCreateTime(DateUtil.formatDateTime(createTime));
	Date lastUpdateTime = DateUtil.parse(authLogEntity.getLastUpdateTime());
	authLogEntity.setLastUpdateTime(DateUtil.formatDateTime(lastUpdateTime));
	resultList.add(authLogEntity);
}
```

<font color=red>但是</font>,突然被告知不能使用第三方类进行转换，得，换一种方法，直接使用`java.text.SimpleDateFormat`进行转换，下面贴代码：

```java
String createTime = null;
try {
	SimpleDateFormat sdf = new SimpleDateFormat("EEE MMM dd HH:mm:ss z yyyy", Locale.US);
	Date date = sdf.parse(authLogEntity.getCreateTime());
	SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
	createTime = simpleDateFormat.format(date);
} catch (Exception e) {
	e.printStackTrace();
}
authLogEntity.setCreateTime(createTime);
```

转换过来集合中存放的值为`2017-10-24 13:18:54`，很明显是所需要的格式。

*注：想到为什么这里不让用第三方工具类，项目中用的jdk是1.7，而第三方类是时刻更新的，有可能会不兼容，或者报错而导致项目起不起来。*

# 另述：

其实，关于时间的格式化处理有好多办法，除了上述两种办法，这里再记录下其他常用的。

1. 首先引入Maven依赖：

   ```xml
   <!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind -->
   <dependency>
       <groupId>com.fasterxml.jackson.core</groupId>
       <artifactId>jackson-databind</artifactId>
       <version>2.9.8</version>
   </dependency>
   ```

   然后在实体类属性中的getter方法添加注解`@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss",timezone = "GMT+8")`，查询到的时间会自动转换。

2. 使用`DateUtil`转换，这个还是比较常用的一种，下面贴代码（可以直接复制使用）：

   ```java
   /**
    * 日期工具类，注意导包import和package
    * StringUtils，DateUtils是Maven依赖commons-lang3的类
    */
   public class DateUtil {
   	/** 年-月-日 时:分:秒 显示格式 */
   	public static String DATE_TO_STRING_DETAIAL_PATTERN = "yyyy-MM-dd HH:mm:ss";
   	/** 年-月-日 显示格式 */
   	public static String DATE_TO_STRING_SHORT_PATTERN = "yyyy-MM-dd";
   	/** 年-月 显示格式 */
   	public static String DATE_TO_STRING_MONTH_PATTERN = "yyyy-MM";
   	private static SimpleDateFormat simpleDateFormat;
   
   	public static Date currentDate() {
   		return  new Date();
   	}
   
   	/**
   	 * 获取当前时间
   	 * @return
        */
   	public static String currentFormatDate() {
   		simpleDateFormat = new SimpleDateFormat(DATE_TO_STRING_DETAIAL_PATTERN);
   		return simpleDateFormat.format(new Date());
   	}
   
   	/**
   	 * date转化为String
   	 * @param date
   	 * @return
        */
   	public static String dateToString(Date date) {
   		simpleDateFormat = new SimpleDateFormat(DATE_TO_STRING_DETAIAL_PATTERN);
   		return simpleDateFormat.format(date);
   	}
   
   	/**
   	 * date转化为String
   	 * @param date
   	 * @return
   	 */
   	public static String dateToShortString(Date date) {
   		simpleDateFormat = new SimpleDateFormat(DATE_TO_STRING_SHORT_PATTERN);
   		return simpleDateFormat.format(date);
   	}
   
   	public static Date addMinuteToDate(int minute){
   		Calendar calendar = Calendar.getInstance();
   		calendar.add(Calendar.MINUTE, minute);
   		Date date = calendar.getTime();
   		return date;
   	}
   
   	/**
   	 * 按照指定格式格式化时间
   	 * @param date
   	 * @param pattern
   	 * @return
   	 */
   	public static String dateToStringByPattern(Date date, String pattern){
   		if(StringUtils.isBlank(pattern)){
   			pattern = DATE_TO_STRING_DETAIAL_PATTERN;
   		}
   		simpleDateFormat = new SimpleDateFormat(pattern);
   		return simpleDateFormat.format(date);
   	}
   
   	/**
   	 * 给指定的日期增加分钟，为空时默认当前时间
   	 * @param minute 增加分钟  正数相加、负数相减
   	 * @return String
   	 */
   	public static String addMinuteToDateStr(int minute){
   		return dateToString(addMinuteToDate(minute));
   	}
   
   	public static Date addDayToDate(int day){
   		Calendar calendar = Calendar.getInstance();
   		calendar.add(Calendar.DATE, day);
   		calendar.set(Calendar.HOUR_OF_DAY, 0);
   		calendar.set(Calendar.SECOND,0);
   		calendar.set(Calendar.MINUTE,0);
   		Date date = calendar.getTime();
   		return date;
   	}
   
   	public static String addDayToDateStr(int day){
   		return dateToString(addDayToDate(day));
   	}
   
   	public static Date getWeekMonday(){
   		Calendar calendar = Calendar.getInstance();
   		calendar.set(GregorianCalendar.DAY_OF_WEEK,GregorianCalendar.MONDAY);
   		calendar.set(Calendar.HOUR_OF_DAY, 0);
   		calendar.set(Calendar.SECOND,0);
   		calendar.set(Calendar.MINUTE,0);
   		Date date = calendar.getTime();
   		return date;
   	}
   
   	public static String getWeekMondayStr(){
   		return dateToString(getWeekMonday());
   	}
   
   	public static Date addWeekToDate(int week){
   		Date date= DateUtils.addWeeks(getWeekMonday(),week);
   		return date;
   	}
   
   	public static String addWeekToDateStr(int week){
   		return dateToString(addWeekToDate(week));
   	}
   
   	/**
   	 * 时间往后推n天的时间
   	 * @param date
   	 * @param day
   	 * @return
   	 */
   	public static Date getNextDay(Date date, int day){
   		try {
   			Calendar calendar = new GregorianCalendar();
   			calendar.setTime(date);
   			calendar.add(Calendar.DATE,day);//把日期往后增加一天.整数往后推,负数往前移动
   			date = calendar.getTime(); //这个时间就是日期往后推一天的结果
   		} catch (Exception e) {
   			e.printStackTrace();
   		}
   		return date;
   	}
   
   	/**
   	 * String转化为Date
   	 * @param date
   	 * @return
   	 */
   	public static Date stringToDate(String date) {
   		simpleDateFormat = new SimpleDateFormat(DATE_TO_STRING_DETAIAL_PATTERN);
   		Date dateFormat = null;
   		try {
   			dateFormat = simpleDateFormat.parse(date);
   		} catch (ParseException e) {
   			e.printStackTrace();
   		}
   		return dateFormat;
   	}
   
   	/**
   	 * String转化为Date
   	 * @param date
   	 * @return
   	 */
   	public static Date stringToShortDate(String date) {
   		simpleDateFormat = new SimpleDateFormat(DATE_TO_STRING_SHORT_PATTERN);
   		Date dateFormat = null;
   		try {
   			dateFormat = simpleDateFormat.parse(date);
   		} catch (ParseException e) {
   			e.printStackTrace();
   		}
   		return dateFormat;
   	}
   
   	/**
   	 * 获取月第一天
   	 * @param month 增加月数  正数相加、负数相减
   	 * @return
   	 */
   	public static Date addMonthToDate(int month){
   		Calendar calendar = Calendar.getInstance();
   		calendar.add(Calendar.MONTH, month);
   		calendar.set(Calendar.DAY_OF_MONTH,1);
   		calendar.set(Calendar.HOUR_OF_DAY, 0);
   		calendar.set(Calendar.SECOND,0);
   		calendar.set(Calendar.MINUTE,0);
   		calendar.set(Calendar.MILLISECOND, 0);
   		Date date = calendar.getTime();
   		return date;
   	}
   
   	/**
   	 * 获取月第一天
   	 * @param date
   	 * @param day
   	 * @return
   	 */
   	public static Date addMonthToDate(String date, int day){
   		simpleDateFormat = new SimpleDateFormat(DATE_TO_STRING_MONTH_PATTERN);
   		Date monthDate = null;
   		try {
   			monthDate = simpleDateFormat.parse(date);
   			Calendar calendar = new GregorianCalendar();
   			calendar.setTime(monthDate);
   			calendar.add(Calendar.MONTH,day);//把日期往后增加一天.整数往后推,负数往前移动
   			monthDate = calendar.getTime(); //这个时间就是日期往后推一天的结果
   		} catch (Exception e) {
   			e.printStackTrace();
   		}
   		return monthDate;
   	}
   
   	/**
   	 * 时间往后推n天的时间
   	 * @param date
   	 * @param day
   	 * @return
   	 */
   	public static Date addDayToDate(Date date, int day){
   		Calendar calendar = new GregorianCalendar();
   		calendar.setTime(date);
   		calendar.set(Calendar.HOUR_OF_DAY, 0);
   		calendar.set(Calendar.SECOND,0);
   		calendar.set(Calendar.MINUTE,0);
   		calendar.add(Calendar.DATE,day);
   		date = calendar.getTime();
   		return date;
   	}
   
   	/**
   	 * date转化为String yyyy-MM
   	 * @param date
   	 * @return
   	 */
   	public static String dateToStringMonth(Date date) {
   		simpleDateFormat = new SimpleDateFormat(DATE_TO_STRING_MONTH_PATTERN);
   		return simpleDateFormat.format(date);
   	}
   
   	/**
   	 * yyyy-MM-dd 转时间戳
   	 * @param dateStr
   	 * @return
   	 */
   	public static Long strToTimestamp(String dateStr) {
   		SimpleDateFormat format = new SimpleDateFormat(DATE_TO_STRING_SHORT_PATTERN);
   		Long timestamp = 0L;
   		try {
   			Date date = format.parse(dateStr);
   			timestamp = date.getTime();
   		} catch (Exception e) {
   			e.printStackTrace();
   		}
   		return timestamp;
   	}
   
   	/**
   	 * 获取当前时间
   	 *
   	 * @return
   	 */
   	public static String currentFormatDate(String pattern) {
   		simpleDateFormat = new SimpleDateFormat(pattern);
   		return simpleDateFormat.format(new Date());
   	}
   
   	/**
   	 * 字符串转日期
   	 * @param dateStr
   	 * @param pattern
   	 * @return
   	 */
   	public static Date strToDate(String dateStr,String pattern){
   		SimpleDateFormat sdf=new SimpleDateFormat(pattern);
   		Date date = null;
   		try {
   			date = sdf.parse(dateStr);
   		} catch (ParseException e) {
   			logger.error("时间转换异常：{}",e);
   		}
   		return date;
   	}
   
   	/**
   	 * 获取指定月的开始日期
   	 * @param currentDate
   	 * @return
   	 */
   	public static Date getStartDate(String currentDate){
   		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
   		Calendar c = Calendar.getInstance();
   		try {
   			c.setTime(sdf.parse(currentDate));
   			c.add(Calendar.MONTH, 0);
   			//设置为1号,当前日期既为本月第一天
   			c.set(Calendar.DAY_OF_MONTH, 1);
   		} catch (ParseException e) {
   			e.printStackTrace();
   		}
   		return c.getTime();
   	}
   
   	/**
   	 * 获取指定月的结束日期
   	 * @param currentDate
   	 * @return
   	 */
   	public static Date getEndDate(String currentDate){
   		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
   		Calendar c = Calendar.getInstance();
   		try {
   			c.setTime(sdf.parse(currentDate));
   			c.set(Calendar.DAY_OF_MONTH, c.getActualMaximum(Calendar.DAY_OF_MONTH));
   			c.set(Calendar.HOUR_OF_DAY, 23);
   			c.set(Calendar.MINUTE, 59);
   			c.set(Calendar.SECOND, 59);
   		} catch (ParseException e) {
   			e.printStackTrace();
   		}
   		return c.getTime();
   	}
   
   	/**
   	 * 获取指定月的开始日期
   	 * @param currentDate
   	 * @return
   	 */
   	public static Date getStartDate(String currentDate,String pattern){
   		SimpleDateFormat sdf = new SimpleDateFormat(pattern);
   		Calendar c = Calendar.getInstance();
   		try {
   			c.setTime(sdf.parse(currentDate));
   			c.add(Calendar.MONTH, 0);
   			//设置为1号,当前日期既为本月第一天
   			c.set(Calendar.DAY_OF_MONTH, 1);
   		} catch (ParseException e) {
   			e.printStackTrace();
   		}
   		return c.getTime();
   	}
   
   	/**
   	 * 获取指定月的结束日期
   	 * @param currentDate
   	 * @return
   	 */
   	public static Date getEndDate(String currentDate,String pattern){
   		SimpleDateFormat sdf = new SimpleDateFormat(pattern);
   		Calendar c = Calendar.getInstance();
   		try {
   			c.setTime(sdf.parse(currentDate));
   			c.set(Calendar.DAY_OF_MONTH, c.getActualMaximum(Calendar.DAY_OF_MONTH));
   			c.set(Calendar.HOUR_OF_DAY, 23);
   			c.set(Calendar.MINUTE, 59);
   			c.set(Calendar.SECOND, 59);
   		} catch (ParseException e) {
   			e.printStackTrace();
   		}
   		return c.getTime();
   	}
   
   }
   ```

   这个工具类基本可以完成大部分的时间格式的处理。

好了，本帖就说到这里。